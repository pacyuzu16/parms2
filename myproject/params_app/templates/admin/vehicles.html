{% extends 'dashboard.html' %}
{% load static %}

{% block content %}
<div class="main-content">
    <div class="top-bar">
        <h2 style="color: #198754;">ðŸš— Vehicles Management</h2>
        <div>
            <a href="{% url 'admin_vehicle_create' %}" class="btn btn-success">
                <i class="fas fa-plus"></i> Add Vehicle
            </a>
        </div>
    </div>

    <!-- Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
        <div class="stat-card glass">
            <div style="text-align: center;">
                <i class="fas fa-car" style="font-size: 2rem; color: #198754; margin-bottom: 10px;"></i>
                <h3 style="color: #198754; margin: 0;">{{ total_vehicles }}</h3>
                <p style="color: #666; margin: 5px 0 0 0;">Total Vehicles</p>
            </div>
        </div>
    </div>

    <!-- Vehicles Table -->
    <div class="card glass fade-in-up">
        <div class="card-body">
            {% if vehicles %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead style="background: linear-gradient(135deg, #198754, #20c997); color: white;">
                            <tr>
                                <th>ID</th>
                                <th>Plate Number</th>
                                <th>Type</th>
                                <th>Owner</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for vehicle in vehicles %}
                            <tr>
                                <td><strong>#{{ vehicle.vehicle_id }}</strong></td>
                                <td>
                                    <strong style="font-family: monospace; font-size: 1.1rem;">{{ vehicle.plate_number }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ vehicle.vehicle_type }}</span>
                                </td>
                                <td>{{ vehicle.owner_name }}</td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <a href="{% url 'admin_vehicle_edit' vehicle.vehicle_id %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <button onclick="deleteVehicle({{ vehicle.vehicle_id }}, '{{ vehicle.plate_number }}')" 
                                                class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-car" style="font-size: 4rem; color: #198754; opacity: 0.5;"></i>
                    <h4 style="color: #198754; margin-top: 20px;">No Vehicles Registered</h4>
                    <p class="text-muted">Add vehicles to the system to start managing parking.</p>
                    <a href="{% url 'admin_vehicle_create' %}" class="btn btn-success">
                        <i class="fas fa-plus"></i> Add First Vehicle
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function deleteVehicle(vehicleId, plateNumber) {
    if (confirm(`Are you sure you want to delete vehicle ${plateNumber}?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/vehicles/${vehicleId}/edit/`;
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                         document.querySelector('meta[name="csrf-token"]')?.content;
        
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
        }

        const actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        actionInput.value = 'delete';
        form.appendChild(actionInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
