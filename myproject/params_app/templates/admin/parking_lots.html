{% extends 'dashboard.html' %}
{% load static %}

{% block content %}
<div class="main-content">
    <div class="top-bar">
        <h2 style="color: #198754;">üìç Parking Lots Management</h2>
        <div>
            <a href="{% url 'admin_parking_lot_create' %}" class="btn btn-success">
                <i class="fas fa-plus"></i> Add Parking Lot
            </a>
        </div>
    </div>

    <!-- Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
        <div class="stat-card glass">
            <div style="text-align: center;">
                <i class="fas fa-map-marker-alt" style="font-size: 2rem; color: #198754; margin-bottom: 10px;"></i>
                <h3 style="color: #198754; margin: 0;">{{ total_lots }}</h3>
                <p style="color: #666; margin: 5px 0 0 0;">Parking Lots</p>
            </div>
        </div>
    </div>

    <!-- Parking Lots Table -->
    <div class="card glass fade-in-up">
        <div class="card-body">
            {% if lots %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead style="background: linear-gradient(135deg, #198754, #20c997); color: white;">
                            <tr>
                                <th>ID</th>
                                <th>Location</th>
                                <th>Total Spaces</th>
                                <th>Available Spaces</th>
                                <th>Occupancy Rate</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lot in lots %}
                            <tr>
                                <td><strong>#{{ lot.lot_id }}</strong></td>
                                <td><strong>{{ lot.location }}</strong></td>
                                <td>{{ lot.total_spaces }}</td>
                                <td>
                                    <span class="badge bg-success">{{ lot.available_spaces }}</span>
                                </td>
                                <td>
                                    {% widthratio lot.total_spaces lot.available_spaces 100 as occupancy_rate %}
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" style="width: {{ occupancy_rate }}%; background: linear-gradient(135deg, #198754, #20c997);">
                                            {{ occupancy_rate }}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <a href="{% url 'admin_parking_lot_edit' lot.lot_id %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <button onclick="deleteLot({{ lot.lot_id }}, '{{ lot.location }}')" 
                                                class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-map-marker-alt" style="font-size: 4rem; color: #198754; opacity: 0.5;"></i>
                    <h4 style="color: #198754; margin-top: 20px;">No Parking Lots</h4>
                    <p class="text-muted">Create parking lots to start managing parking spaces.</p>
                    <a href="{% url 'admin_parking_lot_create' %}" class="btn btn-success">
                        <i class="fas fa-plus"></i> Create First Parking Lot
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function deleteLot(lotId, location) {
    if (confirm(`Are you sure you want to delete parking lot at ${location}?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/parking-lots/${lotId}/edit/`;
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                         document.querySelector('meta[name="csrf-token"]')?.content;
        
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
        }

        const actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        actionInput.value = 'delete';
        form.appendChild(actionInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
