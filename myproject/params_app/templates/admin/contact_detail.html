{% extends 'dashboard.html' %}
{% load static %}

{% block content %}
<div class="main-content">
    <div class="top-bar">
        <h2 style="color: #198754;">ðŸ“§ Message Details</h2>
        <div>
            <a href="{% url 'admin_contacts' %}" class="btn btn-outline-success">
                <i class="fas fa-arrow-left"></i> Back to Messages
            </a>
        </div>
    </div>

    <div class="card glass fade-in-up">
        <div class="card-body">
            <div style="border-bottom: 2px solid #198754; padding-bottom: 20px; margin-bottom: 30px;">
                <h3 style="color: #198754; margin: 0;">{{ message.full_name }}</h3>
                <p style="color: #666; margin: 5px 0 0 0;">
                    <i class="fas fa-envelope"></i> {{ message.email }}
                    <span style="margin-left: 20px;">
                        <i class="fas fa-clock"></i> {{ message.submitted_at|date:"F d, Y g:i A" }}
                    </span>
                </p>
            </div>

            <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
                <h4 style="color: #198754; margin-bottom: 15px;">Message Content:</h4>
                <p style="line-height: 1.6; color: #333; font-size: 16px;">{{ message.message }}</p>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <a href="mailto:{{ message.email }}?subject=Re: Your inquiry&body=Hello {{ message.full_name }},%0D%0A%0D%0AThank you for contacting PARMS.%0D%0A%0D%0ABest regards,%0D%0APARMS Team" 
                   class="btn btn-success">
                    <i class="fas fa-reply"></i> Reply via Email
                </a>
                
                <button onclick="deleteMessage()" class="btn btn-outline-danger">
                    <i class="fas fa-trash"></i> Delete Message
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function deleteMessage() {
    if (confirm('Are you sure you want to delete this message from {{ message.full_name }}?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{% url "admin_contact_detail" message.id %}';
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                         document.querySelector('meta[name="csrf-token"]')?.content;
        
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
        }

        const actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        actionInput.value = 'delete';
        form.appendChild(actionInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
